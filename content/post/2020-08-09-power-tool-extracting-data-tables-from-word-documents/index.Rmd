---
title: 'poweR Tool: Extracting Data Tables from Word Documents'
author: Nathan Brouwer
date: '2020-08-09'
slug: power-tool-extracting-data-tables-from-word-documents
categories:
  - R
tags:
  - data
math: no
meta: yes
toc: yes
editor_options: 
  chunk_output_type: console
---


<!--more-->

## tl;dr

Use the package docxtractr to liberate tables from word files with a few lines of code.

## Intoduction

While there has been exciting growth in adoption of open science practices over the last decade there is not much standardization between or even within journals about how code, data, and other materials get posted.  Its not uncommon therefore to get data - which is happiest in a .csv file or at least a spreadsheet - in a Microsoft Word document or even PDF.

Data in a Word Document isn't hard to liberate:

1. Open the document; upload it to Google Docs first if you don't happen to have access to Word.
1. Highlight the data
1. Copy
1. Paste
1. Re-format as need (e.g., convert merged cells into a single cell)
1. Proofread
1. Save as a .csv

Not too tricky, really.  There are a few minor drawbacks.  The most minor is that you have to do your copying accurately and any reformatting carefully.  This isn't a big deal, and if you do it this way (as I usually do) no big deal as long as you don't have tons of tables to work up.  A somewhat more relevant issue is that you've introduced a step in your workflow that isn't executed and documented in a script and results in a profusion in files; a best practice would be to keep the original Word file, an unaltered spreadsheet version, and a final hand-edited .csv.  There are greater sins against data science and reproducible research than this, but R provides you a way to absolve yourself regardless.

## Case study

Meillere et al. (2015) studied how stress impacts birds and provide a nice, compact datset for demonstrating things to my classes.  The paper was published in The Proceedings of the Royal Societ B,  which has been a leader in publishing raw data alongside their papers.

## Raw data

# The raw data is available via the publisher's website
# https://royalsocietypublishing.org/doi/suppl/10.1098/rsbl.2015.0559)
# in a table in a word document called "rsbl20150559supp1.docx".
# This file is saved in the package folder /inst/extdata
# or just /extdata/sparrowtelomeres.

## Packages
### Data tables can be extracted directly from Word documents
### using docxtractr::docx_extract_all_tbls()


```{r}
# install.packages("docxtractr")
library(docxtractr)
```



## Other packages

```{r}
library(here)
```



## File folder and relative location

```{r}
home <- here::here()
list.dirs(home)
data.dir <- here::here("inst/extdata/sparrowtelomeres")
list.files(data.dir)
list.files(data.dir,  full.names = T)
dir.exists(data.dir)
```



## File name
```{r}
file.name <- "rsbl20150559supp1.docx"
file.full <- here::here("inst/extdata/sparrowtelomeres",
                        file.name)
file.exists(file.full)
```





## Alternate - file URL
```{r}
file.url <-  "https://royalsocietypublishing.org/action/downloadSupplement?doi=10.1098%2Frsbl.2015.0559&file=rsbl20150559supp1.docx"
```



## Extract docx
### Load docx

https://cran.r-project.org/web/packages/docxtractr/index.html

LibreOffice (<https://www.libreoffice.org/>)
required to extract data from .doc files or perform .pptx
conversion.

xml2, purrr, dplyr, utils, httr , magrittr

Bob Rudis @hrbrmstr

read_docx: Read in a Word document for table extraction

docx_describe_tbls: Returns a description of all the tables in the
Word document

docx_describe_cmnts: Returns a description of all the comments in
the Word document

docx_extract_tbl: Extract a table from a Word document

docx_extract_all_cmnts: Extract comments from a Word document

docx_extract_all_tbls: Extract all tables from a Word document
(docx_extract_all is now deprecated)

docx_tbl_count: Get number of tables in a Word document

docx_cmnt_count: Get number of comments in a Word document

assign_colnames: Make a specific row the column names for the
specified data.frame

mcga : Make column names great again

set_libreoffice_path: Point to Local soffice.exe File


```{r}
file.docx <- docxtractr::read_docx(file.full)

```


### Extract tables
```{r}

docx.table.list <- docxtractr::docx_extract_all_tbls(docx = file.docx)

```

### Works with the URL too
```{r}
file.docx <- docxtractr::read_docx(file.url)
docx.table.list <- docxtractr::docx_extract_all_tbls(docx = file.docx)

```



## Produces list of tables
```{r}
is(docx.table.list)
length(docx.table.list)
str(docx.table.list)
```



## Call each table from list
### nestlings
```{r}
parus_telos_nest <- docx.table.list[[1]]

```


### adults
```{r}
parus_telos_adult  <- docx.table.list[[2]]

```


## Examine data
```{r}
summary(parus_telos_fledge)
```



## Set up columns as factors or numeric
### column names

```{r}
nest.char.columns <- c("nest","treatment","fledging")
adult.char.columns <- c("nest","treatment","sex")

head(parus_telos_nest)
head(parus_telos_nest[,nest.char.columns])

```


